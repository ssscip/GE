<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Terra ‚Äî MODIS (GIBS) + MOPITT (COG) ‚Äî demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="styles.css">
  <style>
    html,body,#map { height:100%; margin:0; padding:0; }
    .controls { position: absolute; z-index: 1000; right: 12px; top: 12px; background: rgba(0,0,0,0.6); color:#fff; padding:10px; border-radius:8px; font-family:system-ui; }
    .controls label { display:block; font-size:13px; margin-bottom:6px; }
    button { cursor:pointer; }

    /* Improved styling for controls */
    .controls {
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      backdrop-filter: blur(4px);
    }

    /* Style for popup content */
    .custom-popup {
      font-family: system-ui;
      line-height: 1.5;
    }

    /* Ensure media inside popups fits */
    .custom-popup video, .custom-popup img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-top: 8px;
      border-radius: 6px;
    }

    /* Style for buttons */
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #4a90e2;
      color: white;
      transition: background 0.2s;
    }

    button:hover {
      background: #357abd;
    }
    /* marker icon (emoji) */
    .marker-icon {
      width: 34px;
      height: 34px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255,255,255,0.95);
      color: #111;
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
      font-size: 18px;
      border: 2px solid rgba(0,0,0,0.08);
    }
    .custom-div-icon {
      background: transparent;
      border: 0;
    }

    /* Back to Home button */
    .back-to-home {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1001;
      background: rgba(255,255,255,0.9);
      color: #333;
      padding: 8px 16px;
      border-radius: 4px;
      text-decoration: none;
      font-family: system-ui;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: background 0.2s, transform 0.2s;
    }

    .back-to-home:hover {
      background: rgba(255,255,255,1);
      transform: translateY(-2px);
    }

    /* Header styles */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      transition: background 0.3s;
    }

    #header-logo {
      height: 40px;
      margin-right: 20px;
    }

    /* Scroll effect for header */
    body.scrolled header {
      background: rgba(0,0,0,1);
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-to-home">Back to Home</a>
  <header>
    <img id="header-logo" src="assets/images/logo.png" alt="Logo">
  </header>
  <div id="map"></div>

  <div class="controls" id="controls">
    <label>
      <strong>MODIS (Terra) ‚Äî TrueColor (GIBS)</strong>
    </label>
    <label>
      –î–∞—Ç–∞:
      <input id="dateInput" type="date" value="2020-07-01" max="2025-12-31" min="2000-01-01" />
    </label>
    <label style="margin-top:8px;">
      –î–∞—Ç–∞: <span id="dateLabel">2020-07-01</span>
      <input id="dateSlider" type="range" min="0" max="0" step="1" value="0" style="width:220px; display:block; margin-top:6px;" />
    </label>
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
      <button id="applyBtn">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –¥–∞—Ç—É</button>
      <button id="toggleModis">–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ MODIS</button>
      <button id="zoomAllBtn">–ó–≥–æ—Ä–Ω—É—Ç–∏ –¥–æ –≤—Å—ñ—Ö</button>
    </div>
    <label style="display:flex;align-items:center;gap:8px;margin-top:8px;">
      <input id="showAllCheckbox" type="checkbox" />
      <span>–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ñ–ª–∞–≥–∏</span>
    </label>
    <div style="margin-top:8px; font-size:13px; color:#fff; display:flex;align-items:center;gap:10px;">
      <span>–í–∏–¥–∏–º—ñ —Ñ–ª–∞–≥–∏: <strong id="visibleCount">0</strong></span>
    </div>
    <div id="legend" style="margin-top:8px; font-size:13px; color:#fff;">
      <strong>–õ–µ–≥–µ–Ω–¥–∞:</strong>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
        <div style="display:flex;align-items:center;gap:10px;color:#fff;font-size:13px;"><div class="marker-icon" style="width:20px;height:20px;font-size:12px;">üî•</div><span>–ü–æ–∂–µ–∂–∞</span></div>
        <div style="display:flex;align-items:center;gap:10px;color:#fff;font-size:13px;"><div class="marker-icon" style="width:20px;height:20px;font-size:12px;">üåä</div><span>–ü–æ–≤—ñ–Ω—å / –¶—É–Ω–∞–º—ñ</span></div>
        <div style="display:flex;align-items:center;gap:10px;color:#fff;font-size:13px;"><div class="marker-icon" style="width:20px;height:20px;font-size:12px;">üåÄ</div><span>–£—Ä–∞–≥–∞–Ω</span></div>
        <div style="display:flex;align-items:center;gap:10px;color:#fff;font-size:13px;"><div class="marker-icon" style="width:20px;height:20px;font-size:12px;">üåã</div><span>–ó–µ–º–ª–µ—Ç—Ä—É—Å</span></div>
        <div style="display:flex;align-items:center;gap:10px;color:#fff;font-size:13px;"><div class="marker-icon" style="width:20px;height:20px;font-size:12px;">‚òÄÔ∏è</div><span>–ü–æ—Å—É—Ö–∞ / –°–ø–µ–∫–∞</span></div>
      </div>
    </div>

    <hr style="margin:8px 0; border-color: rgba(255,255,255,0.08)">


  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  
  <script>
    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã ---
    // Initialize map with bounds restriction
    const map = L.map('map', {
      // Set initial view to show Ukraine region
      center: [48.3794, 31.1656],
      zoom: 6,
      // Set maximum and minimum zoom levels
      maxZoom: 18,
      minZoom: 2,
      // Set map bounds to cover entire world
      maxBounds: [
        [-90, -180], // Southwest coordinates (South Pole)
        [90, 180]    // Northeast coordinates (North Pole)
      ],
      maxBoundsViscosity: 1.0 // Makes the bounds completely solid
    });

    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // --- MODIS via NASA GIBS (WMTS/XYZ style) ---
    // Layer id –¥–ª—è Terra TrueColor:
    const MODIS_LAYER_ID = 'MODIS_Terra_CorrectedReflectance_TrueColor';
    const TILE_MATRIX = 'GoogleMapsCompatible_Level9'; // —á–∞—Å—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç; GIBS –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä—ã
    // –æ–±—Ä–∞–∑–µ—Ü WMTS/XYZ URL (GIBS)
    // —Ñ–æ—Ä–º–∞—Ç: https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/{layer}/default/{time}/{tileMatrixSet}/{z}/{y}/{x}.jpg
    function makeGIBSUrl(layerId, dateStr) {
      // dateStr –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
      return `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/${layerId}/default/${dateStr}/${TILE_MATRIX}/{z}/{y}/{x}.jpg`;
    }

    let modisDate = document.getElementById('dateInput').value || '2020-07-01';
    let modisLayer = L.tileLayer(makeGIBSUrl(MODIS_LAYER_ID, modisDate), {
      tileSize: 256,
      opacity: 0.95,
      attribution: 'NASA GIBS'
    }).addTo(map);

  

    // --- Additional event markers/popups ---
  // Odessa (floods) ‚Äî detailed per user's latest data
  const OdessaCoords = [46.291083, 30.44366];
  const odessaMarker = L.marker(OdessaCoords).addTo(map);
  const odessaPopupContent = `
    <div class="custom-popup">
      <h3>–ü–æ–≤—ñ–Ω—å –≤ –û–¥–µ—Å—ñ</h3>
      <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –û–¥–µ—Å–∞, –£–∫—Ä–∞—ó–Ω–∞</p>
      <p>–î–∞—Ç–∞: 30 –≤–µ—Ä–µ—Å–Ω—è 2025 —Ä–æ–∫—É</p>
      <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
      <p>–ü–æ—Ç—É–∂–Ω–∞ –∑–ª–∏–≤–∞, –∑–∞ –¥–æ–±—É –≤–∏–ø–∞–ª–æ –±–ª–∏–∑—å–∫–æ 94 –º–º –æ–ø–∞–¥—ñ–≤, —â–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å ‚âà224% –º—ñ—Å—è—á–Ω–æ—ó –Ω–æ—Ä–º–∏.
      –ó–ª–∏–≤–∞ –ø–∞—Ä–∞–ª—ñ–∑—É–≤–∞–ª–∞ —Ä—É—Ö, –ø—ñ–¥—Ç–æ–ø–ª–µ–Ω—ñ –ø—Ä–∏–≤–∞—Ç–Ω—ñ —ñ –±–∞–≥–∞—Ç–æ–ø–æ–≤–µ—Ä—Ö–æ–≤—ñ –±—É–¥–∏–Ω–∫–∏, –¥–æ—Ä–æ–≥–∏, –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ —ñ–Ω–∂–µ–Ω–µ—Ä–Ω—ñ –º–µ—Ä–µ–∂—ñ.</p>
      <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> 10 –æ—Å—ñ–± –∑–∞–≥–∏–Ω—É–ª–æ.</p>
      <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
      <p>–ü–æ–Ω–∞–¥ 800 –±—É–¥—ñ–≤–µ–ª—å –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ (‚âà500 –±–∞–≥–∞—Ç–æ–ø–æ–≤–µ—Ä—Ö—ñ–≤–æ–∫ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –±—É–¥–∏–Ω–∫—ñ–≤), –∑–Ω–∞—á–Ω—ñ —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –¥–æ—Ä—ñ–≥ —Ç–∞ —ñ–Ω–∂–µ–Ω–µ—Ä–Ω–∏—Ö –º–µ—Ä–µ–∂, –ø–æ—à–∫–æ–¥–∂–µ–Ω–∞ –∫–æ–º—É–Ω–∞–ª—å–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –ë–ª–∏–∑—å–∫–æ 70 –¥–µ—Ä–µ–≤ —ñ –≤–µ–ª–∏–∫–∏—Ö –≥—ñ–ª–æ–∫ –ø–æ–≤–∞–ª–µ–Ω–æ, –±–ª–∏–∑—å–∫–æ 23 000 —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ –∑–∞–ª–∏—à–∏–ª–∏—Å—è –±–µ–∑ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è.</p>
    </div>
  `;
  odessaMarker.bindPopup(odessaPopupContent, { maxWidth: 360, className: 'custom-popup' });

    // European heatwave 2003 (Western & Central Europe)
    const heat2003Coords = [46.0, 6.0]; // central coords over western/central Europe
    const heat2003 = L.marker(heat2003Coords).addTo(map);
    const heat2003Popup = `
      <div class="custom-popup">
        <h3>–Ñ–≤—Ä–æ–ø–µ–π—Å—å–∫–∞ —Å–ø–µ–∫–∞ (2003)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ó–∞—Ö—ñ–¥–Ω–∞ —Ç–∞ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –Ñ–≤—Ä–æ–ø–∞ (–§—Ä–∞–Ω—Ü—ñ—è, –Ü—Ç–∞–ª—ñ—è, –ù—ñ–º–µ—á—á–∏–Ω–∞)</p>
        <p>–î–∞—Ç–∞: –õ–∏–ø–µ–Ω—å‚Äì—Å–µ—Ä–ø–µ–Ω—å 2003 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–•–≤–∏–ª—è —Å–ø–µ–∫–∏ –∑ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º–∏ –ø–æ–Ω–∞–¥ +40 ¬∞C. –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –¥–æ —Ç–∞–∫–∏—Ö —É–º–æ–≤ –ø—Ä–∏–∑–≤–µ–ª–∞ –¥–æ –º–∞—Å–æ–≤–∏—Ö —Å–º–µ—Ä—Ç–µ–π.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 70 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–í–∏—Å–∏—Ö–∞–Ω–Ω—è —Ä—ñ—á–æ–∫ (–†–µ–π–Ω, –õ—É–∞—Ä–∞), —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –≤—Ä–æ–∂–∞—ó–≤, –ø—Ä–æ–±–ª–µ–º–∏ –∑ –µ–Ω–µ—Ä–≥–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è–º, –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—ñ —Å–µ—Ä–µ–¥ –ª—ñ—Ç–Ω—ñ—Ö –ª—é–¥–µ–π, –ø–æ—à—Ç–æ–≤—Ö –¥–æ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∞–¥–∞–ø—Ç–∞—Ü—ñ—ó –¥–æ –∫–ª—ñ–º–∞—Ç–∏—á–Ω–∏—Ö –∑–º—ñ–Ω —É –Ñ–°.</p>
      </div>
    `;
    heat2003.bindPopup(heat2003Popup, { maxWidth: 320, className: 'custom-popup' });

    // Germany floods (July 2021) ‚Äî Rheinland-Pfalz, North Rhine-Westphalia
    const ger2021Coords = [50.5, 7.0];
    const ger2021 = L.marker(ger2021Coords).addTo(map);
    const ger2021Popup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤—ñ–Ω—å —É –ù—ñ–º–µ—á—á–∏–Ω—ñ (2021)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –†–µ–π–Ω–ª–∞–Ω–¥-–ü—Ñ–∞–ª—å—Ü, –ü—ñ–≤–Ω—ñ—á–Ω–∏–π –†–µ–π–Ω-–í–µ—Å—Ç—Ñ–∞–ª—ñ—è</p>
        <p>–î–∞—Ç–∞: –õ–∏–ø–µ–Ω—å 2021 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π—Å–∏–ª—å–Ω—ñ—à—ñ –¥–æ—â—ñ –∑–∞ –¥–µ—Å—è—Ç–∏–ª—ñ—Ç—Ç—è —Å–ø—Ä–∏—á–∏–Ω–∏–ª–∏ —Ä–∞–ø—Ç–æ–≤—ñ –ø–æ–≤–µ–Ω—ñ.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 180 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–†—É–π–Ω—É–≤–∞–Ω–Ω—è –±—É–¥–∏–Ω–∫—ñ–≤ —ñ –º–æ—Å—Ç—ñ–≤, ‚âà30 –º–ª—Ä–¥ ‚Ç¨ –∑–±–∏—Ç–∫—ñ–≤, 200 —Ç–∏—Å. –ª—é–¥–µ–π –∑–∞–ª–∏—à–∏–ª–∏—Å—è –±–µ–∑ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è, –ø–æ—à—Ç–æ–≤—Ö –¥–æ –Ω–æ–≤–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ –∞–¥–∞–ø—Ç–∞—Ü—ñ—ó –¥–æ –∫–ª—ñ–º–∞—Ç—É —É –ù—ñ–º–µ—á—á–∏–Ω—ñ.</p>
      </div>
    `;
    ger2021.bindPopup(ger2021Popup, { maxWidth: 340, className: 'custom-popup' });

    // Lytton heatwave (Canada, June 2021)
    const lyttonCoords = [50.170, -121.593];
    const lytton = L.marker(lyttonCoords).addTo(map);
    const lyttonPopup = `
      <div class="custom-popup">
        <h3>–°–ø–µ–∫–∞ –≤ –ö–∞–Ω–∞–¥—ñ (–õ—ñ—Ç—Ç–æ–Ω, 2021)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ë—Ä–∏—Ç–∞–Ω—Å—å–∫–∞ –ö–æ–ª—É–º–±—ñ—è, –ö–∞–Ω–∞–¥–∞</p>
        <p>–î–∞—Ç–∞: –ß–µ—Ä–≤–µ–Ω—å 2021 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–†–µ–∫–æ—Ä–¥–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ +49,6 ¬∞C ‚Äî –Ω–∞–π–≤–∏—â–∞ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –ö–∞–Ω–∞–¥–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 600 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ú—ñ—Å—Ç–æ –õ—ñ—Ç—Ç–æ–Ω —á–∞—Å—Ç–∫–æ–≤–æ/–ø–æ–≤–Ω—ñ—Å—Ç—é –∑–≥–æ—Ä—ñ–ª–æ, –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏, –ø—Ä–æ–±–ª–µ–º–∏ –∑ –µ–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º–æ—é, —à–∏—Ä–æ–∫—ñ –ø–æ–∂–µ–∂—ñ.</p>
      </div>
    `;
    lytton.bindPopup(lyttonPopup, { maxWidth: 320, className: 'custom-popup' });

    // Pakistan floods (2022)
    const pakistan22Coords = [30.0, 70.0];
    const pakistan22 = L.marker(pakistan22Coords).addTo(map);
    const pakistan22Popup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤–µ–Ω—ñ –≤ –ü–∞–∫–∏—Å—Ç–∞–Ω—ñ (2022)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ü–∞–∫–∏—Å—Ç–∞–Ω</p>
        <p>–î–∞—Ç–∞: –°–µ—Ä–ø–µ–Ω—å‚Äì–≤–µ—Ä–µ—Å–µ–Ω—å 2022 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–¥–∑–≤–∏—á–∞–π–Ω—ñ –º—É—Å–æ–Ω–Ω—ñ –¥–æ—â—ñ, —â–æ –∑–∞—Ç–æ–ø–∏–ª–∏ –≤–µ–ª–∏–∫—É —á–∞—Å—Ç–∏–Ω—É –∫—Ä–∞—ó–Ω–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 1 700 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>33 –º–ª–Ω –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö, –∑—Ä—É–π–Ω–æ–≤–∞–Ω–æ ‚âà2 –º–ª–Ω –±—É–¥–∏–Ω–∫—ñ–≤, —Å–ø–∞–ª–∞—Ö —Ö–≤–æ—Ä–æ–± (—Ö–æ–ª–µ—Ä–∞, –º–∞–ª—è—Ä—ñ—è), –∑–±–∏—Ç–∫–∏ –ø–æ–Ω–∞–¥ $30 –º–ª—Ä–¥.</p>
      </div>
    `;
    pakistan22.bindPopup(pakistan22Popup, { maxWidth: 340, className: 'custom-popup' });

    // Global heat 2023
    const globalHeatCoords = [0.0, 0.0];
    const globalHeat = L.marker(globalHeatCoords).addTo(map);
    const globalHeatPopup = `
      <div class="custom-popup">
        <h3>–ì–ª–æ–±–∞–ª—å–Ω–∞ —Å–ø–µ–∫–∞ (2023)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –í–µ—Å—å —Å–≤—ñ—Ç</p>
        <p>–î–∞—Ç–∞: 2023 —Ä—ñ–∫</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π—Å–ø–µ–∫–æ—Ç–Ω—ñ—à–∏–π —Ä—ñ–∫ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó; —Å–µ—Ä–µ–¥–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–∏—â–∏–ª–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–∫–æ—Ä–¥ 2016 —Ä–æ–∫—É.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –¥–µ—Å—è—Ç–∫–∏ —Ç–∏—Å—è—á –ª—é–¥–µ–π —É–Ω–∞—Å–ª—ñ–¥–æ–∫ —Ö–≤–∏–ª—å —Å–ø–µ–∫–∏.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ú–∞—Å–æ–≤—ñ –ø–æ–∂–µ–∂—ñ (–ö–∞–Ω–∞–¥–∞, –ì—Ä–µ—Ü—ñ—è, –Ü—Å–ø–∞–Ω—ñ—è), —Ç–∞–Ω–µ–Ω–Ω—è –ª—å–æ–¥–æ–≤–∏–∫—ñ–≤, –ø—ñ–¥–Ω—è—Ç—Ç—è —Ä—ñ–≤–Ω—è –º–æ—Ä—è, –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏—Ö —è–≤–∏—â.</p>
      </div>
    `;
    globalHeat.bindPopup(globalHeatPopup, { maxWidth: 360, className: 'custom-popup' });

    // Arctic temperature anomalies (2024)
    const arcticCoords = [75.0, -40.0];
    const arcticAnom = L.marker(arcticCoords).addTo(map);
    const arcticPopup = `
      <div class="custom-popup">
        <h3>–ê—Ä–∫—Ç–∏—á–Ω—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ñ –∞–Ω–æ–º–∞–ª—ñ—ó (2024)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ì—Ä–µ–Ω–ª–∞–Ω–¥—ñ—è, –°–∏–±—ñ—Ä, –ü—ñ–≤–Ω—ñ—á–Ω–∞ –ö–∞–Ω–∞–¥–∞</p>
        <p>–î–∞—Ç–∞: 2024 —Ä—ñ–∫</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –ê—Ä–∫—Ç–∏—Ü—ñ –Ω–∞ 15‚Äì20 ¬∞C –≤–∏—â–µ –Ω–æ—Ä–º–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –Ω–µ–º–∞—î –ø—Ä—è–º–æ–≥–æ –≤–ø–ª–∏–≤—É –Ω–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—è.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–µ —Ç–∞–Ω–µ–Ω–Ω—è –ª—å–æ–¥–æ–≤–∏–∫—ñ–≤, –ø—ñ–¥–Ω—è—Ç—Ç—è —Ä—ñ–≤–Ω—è –æ–∫–µ–∞–Ω—É, –ø–æ—Ä—É—à–µ–Ω–Ω—è —Ü–∏—Ä–∫—É–ª—è—Ü—ñ—ó –ø–æ–≤—ñ—Ç—Ä—è, –≤–ø–ª–∏–≤ –Ω–∞ –ø–æ–≥–æ–¥—É –≤ —Å–µ—Ä–µ–¥–Ω—ñ—Ö —à–∏—Ä–æ—Ç–∞—Ö.</p>
      </div>
    `;
    arcticAnom.bindPopup(arcticPopup, { maxWidth: 340, className: 'custom-popup' });

    // Rio de Janeiro floods (Feb 2022)
    const rioCoords = [-22.9068, -43.1729];
    const rioFloods = L.marker(rioCoords).addTo(map);
    const rioPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤–µ–Ω—ñ —É –ë—Ä–∞–∑–∏–ª—ñ—ó (–†—ñ–æ-–¥–µ-–ñ–∞–Ω–µ–π—Ä–æ, 2022)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ë—Ä–∞–∑–∏–ª—ñ—è, —à—Ç–∞—Ç –†—ñ–æ-–¥–µ-–ñ–∞–Ω–µ–π—Ä–æ</p>
        <p>–î–∞—Ç–∞: –õ—é—Ç–∏–π 2022 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–°–∏–ª—å–Ω—ñ –∑–ª–∏–≤–∏ —Å–ø—Ä–∏—á–∏–Ω–∏–ª–∏ —Å–µ–ª–µ–≤—ñ –ø–æ—Ç–æ–∫–∏ —Ç–∞ –æ–±–≤–∞–ª–∏ –≤ –≥—ñ—Ä—Å—å–∫–∏—Ö —Ä–∞–π–æ–Ω–∞—Ö.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 230 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó—Ä—É–π–Ω–æ–≤–∞–Ω—ñ –±—É–¥–∏–Ω–∫–∏, –∑–Ω–∏–∫–ª—ñ –±–µ–∑–≤—ñ—Å—Ç–∏, –µ–≤–∞–∫—É–∞—Ü—ñ—ó, –∑–Ω–∞—á–Ω—ñ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –≤—Ç—Ä–∞—Ç–∏ –¥–ª—è —Ä–µ–≥—ñ–æ–Ω—É.</p>
      </div>
    `;
    rioFloods.bindPopup(rioPopup, { maxWidth: 340, className: 'custom-popup' });

    // Hurricane Irma (2017)
    const irmaCoords = [18.0, -66.5];
    const irma = L.marker(irmaCoords).addTo(map);
    const irmaPopup = `
      <div class="custom-popup">
        <h3>–£—Ä–∞–≥–∞–Ω ¬´–Ü—Ä–º–∞¬ª (2017)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ö–∞—Ä–∏–±—Å—å–∫–∏–π –±–∞—Å–µ–π–Ω, –°–®–ê (–§–ª–æ—Ä–∏–¥–∞)</p>
        <p>–î–∞—Ç–∞: –í–µ—Ä–µ—Å–µ–Ω—å 2017 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–£—Ä–∞–≥–∞–Ω 5-—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –≤—ñ—Ç—Ä–∞–º–∏ –ø–æ–Ω–∞–¥ 295 –∫–º/–≥–æ–¥.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 130 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó–Ω–∏—â–µ–Ω—ñ –æ—Å—Ç—Ä–æ–≤–∏ –ë–∞—Ä–±—É–¥–∞, –°–µ–Ω-–ú–∞—Ä—Ç–µ–Ω, —á–∞—Å—Ç–∏–Ω–∏ –ö—É–±–∏ —Ç–∞ –§–ª–æ—Ä–∏–¥–∏; –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –∑–±–∏—Ç–∫–∏ ‚âà $77 –º–ª—Ä–¥; –º–∞—Å–æ–≤—ñ –µ–≤–∞–∫—É–∞—Ü—ñ—ó.</p>
      </div>
    `;
    irma.bindPopup(irmaPopup, { maxWidth: 320, className: 'custom-popup' });

    // Hurricane Maria (2017) ‚Äî Puerto Rico
    const mariaCoords = [18.2, -66.5];
    const maria = L.marker(mariaCoords).addTo(map);
    const mariaPopup = `
      <div class="custom-popup">
        <h3>–£—Ä–∞–≥–∞–Ω ¬´–ú–∞—Ä—ñ—è¬ª (2017)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ü—É–µ—Ä—Ç–æ-–†–∏–∫–æ</p>
        <p>–î–∞—Ç–∞: –í–µ—Ä–µ—Å–µ–Ω—å 2017 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ü–æ—Ç—É–∂–Ω–∏–π —É—Ä–∞–≥–∞–Ω 5-—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, —è–∫–∏–π –æ–±—Ä—É—à–∏–≤—Å—è –Ω–∞ –ü—É–µ—Ä—Ç–æ-–†–∏–∫–æ –ø—ñ—Å–ª—è ¬´–Ü—Ä–º–∏¬ª.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 3 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü–æ–≤–Ω–µ —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂, –¥–µ—Ñ—ñ—Ü–∏—Ç –ø–∏—Ç–Ω–æ—ó –≤–æ–¥–∏, –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∞ –∫—Ä–∏–∑–∞, –∑–Ω–∞—á–Ω—ñ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –∑–±–∏—Ç–∫–∏.</p>
      </div>
    `;
    maria.bindPopup(mariaPopup, { maxWidth: 320, className: 'custom-popup' });

    // Camp Fire (California, 2018)
    const campFireCoords = [39.8, -121.6];
    const campFire = L.marker(campFireCoords).addTo(map);
    const campFirePopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –ö–∞–ª—ñ—Ñ–æ—Ä–Ω—ñ—ó (Camp Fire, 2018)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ö–∞–ª—ñ—Ñ–æ—Ä–Ω—ñ—è, –°–®–ê</p>
        <p>–î–∞—Ç–∞: –õ–∏—Å—Ç–æ–ø–∞–¥ 2018 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π—Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω—ñ—à–∞ –ø–æ–∂–µ–∂–∞ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –ö–∞–ª—ñ—Ñ–æ—Ä–Ω—ñ—ó, —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∞ —Å–∏–ª—å–Ω–∏–º –≤—ñ—Ç—Ä–æ–º —ñ –ø–æ—Å—É—Ö–æ—é.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> 85 –æ—Å—ñ–±, –ø–æ–Ω–∞–¥ 18 000 –±—É–¥–∏–Ω–∫—ñ–≤ –∑–Ω–∏—â–µ–Ω–æ.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü–æ–≤–Ω–µ –∑–Ω–∏—â–µ–Ω–Ω—è –º—ñ—Å—Ç–∞ –ü–∞—Ä–∞–¥–∞–π–∑, –∑–±–∏—Ç–∫–∏ ‚âà $16 –º–ª—Ä–¥, –ø–æ—Å–∏–ª–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –ø–æ–∂–µ–∂–Ω–æ—ó –±–µ–∑–ø–µ–∫–∏.</p>
      </div>
    `;
    campFire.bindPopup(campFirePopup, { maxWidth: 320, className: 'custom-popup' });

    // Siberia / Arctic fires (2019-2021)
    const siberiaCoords = [64.0, 105.0];
    const siberia = L.marker(siberiaCoords).addTo(map);
    const siberiaPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –°–∏–±—ñ—Ä—É —Ç–∞ –ê—Ä–∫—Ç–∏—Ü—ñ (2019‚Äì2021)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –Ø–∫—É—Ç—ñ—è, –ö—Ä–∞—Å–Ω–æ—è—Ä—Å—å–∫–∏–π –∫—Ä–∞–π, –∞—Ä–∫—Ç–∏—á–Ω—ñ —Ä–µ–≥—ñ–æ–Ω–∏ –†–æ—Å—ñ—ó</p>
        <p>–î–∞—Ç–∞: 2019‚Äì2021 —Ä–æ–∫–∏</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ú–∞—Å–æ–≤—ñ –ø–æ–∂–µ–∂—ñ –≤ —Ç—É–Ω–¥—Ä—ñ —Ç–∞ —Ç–∞–π–∑—ñ; –ø–ª–æ—â–∞ –≤–∏–≥–æ—Ä—è–Ω–Ω—è ‚Äî –º—ñ–ª—å–π–æ–Ω–∏ –≥–µ–∫—Ç–∞—Ä—ñ–≤.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –∫—ñ–ª—å–∫–∞ –¥–µ—Å—è—Ç–∫—ñ–≤ –ª—é–¥–µ–π, –º—ñ–ª—å–π–æ–Ω–∏ —Ç–≤–∞—Ä–∏–Ω.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–í–∏–∫–∏–¥–∏ CO‚ÇÇ, —Ç–∞–Ω–µ–Ω–Ω—è –≤—ñ—á–Ω–æ—ó –º–µ—Ä–∑–ª–æ—Ç–∏, –¥–æ–≤–≥–æ—Ç—Ä–∏–≤–∞–ª—ñ –µ–∫–æ–ª–æ–≥—ñ—á–Ω—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏.</p>
      </div>
    `;
    siberia.bindPopup(siberiaPopup, { maxWidth: 340, className: 'custom-popup' });

    // Yangtze / China floods (2020)
    const yangtzeCoords = [31.0, 112.0];
    const yangtze = L.marker(yangtzeCoords).addTo(map);
    const yangtzePopup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤–µ–Ω—ñ –≤ –ö–∏—Ç–∞—ó (–Ø–Ω—Ü–∑–∏, 2020)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –±–∞—Å–µ–π–Ω —Ä—ñ—á–∫–∏ –Ø–Ω—Ü–∑–∏, –ö–∏—Ç–∞–π</p>
        <p>–î–∞—Ç–∞: –õ–∏–ø–µ–Ω—å‚Äì—Å–µ—Ä–ø–µ–Ω—å 2020 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π—Å–∏–ª—å–Ω—ñ—à—ñ –¥–æ—â—ñ –∑–∞ 60 —Ä–æ–∫—ñ–≤, –ø—ñ–¥–Ω—è—Ç—Ç—è —Ä—ñ–≤–Ω—è —Ä—ñ—á–æ–∫, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –¥–∞–º–±.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 200 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ï–≤–∞–∫—É–∞—Ü—ñ—è ‚âà4 –º–ª–Ω –ª—é–¥–µ–π, –∑–∞—Ç–æ–ø–ª–µ–Ω–Ω—è —Å—ñ–ª—å–≥–æ—Å–ø—É–≥—ñ–¥—å, –∑–±–∏—Ç–∫–∏ ‚âà $35 –º–ª—Ä–¥.</p>
      </div>
    `;
    yangtze.bindPopup(yangtzePopup, { maxWidth: 340, className: 'custom-popup' });

    // Haiti earthquake (2010)
    const haitiCoords = [18.5333, -72.3333];
    const haiti = L.marker(haitiCoords).addTo(map);
    const haitiPopup = `
      <div class="custom-popup">
        <h3>–ó–µ–º–ª–µ—Ç—Ä—É—Å —É –ì–∞—ó—Ç—ñ (2010)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ì–∞—ó—Ç—ñ (–ø–æ–±–ª–∏–∑—É –ü–æ—Ä—Ç-–æ-–ü—Ä–µ–Ω—Å)</p>
        <p>–î–∞—Ç–∞: 12 —Å—ñ—á–Ω—è 2010 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ó–µ–º–ª–µ—Ç—Ä—É—Å –º–∞–≥–Ω—ñ—Ç—É–¥–æ—é 7,0 —Å–ø—Ä–∏—á–∏–Ω–∏–≤ –∫–æ–ª–æ—Å–∞–ª—å–Ω—ñ —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –±–ª–∏–∑—å–∫–æ 230 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó—Ä—É–π–Ω–æ–≤–∞–Ω—ñ –ª—ñ–∫–∞—Ä–Ω—ñ, —à–∫–æ–ª–∏, –±—É–¥–∏–Ω–∫–∏; –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∞ –∫—Ä–∏–∑–∞; —Å–ø–∞–ª–∞—Ö —Ö–æ–ª–µ—Ä–∏.</p>
      </div>
    `;
    haiti.bindPopup(haitiPopup, { maxWidth: 340, className: 'custom-popup' });

    // Nepal earthquake (2015)
    const nepalCoords = [28.3949, 84.1240];
    const nepal = L.marker(nepalCoords).addTo(map);
    const nepalPopup = `
      <div class="custom-popup">
        <h3>–ó–µ–º–ª–µ—Ç—Ä—É—Å —É –ù–µ–ø–∞–ª—ñ (2015)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ö–∞—Ç–º–∞–Ω–¥—É —Ç–∞ –ì—ñ–º–∞–ª–∞—ó</p>
        <p>–î–∞—Ç–∞: –ö–≤—ñ—Ç–µ–Ω—å 2015 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ó–µ–º–ª–µ—Ç—Ä—É—Å –º–∞–≥–Ω—ñ—Ç—É–¥–æ—é 7,8, —è–∫–∏–π –∑—Ä—É–π–Ω—É–≤–∞–≤ –≤–µ–ª–∏–∫—ñ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 8 900 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–†—É–π–Ω—É–≤–∞–Ω–Ω—è —Ö—Ä–∞–º—ñ–≤, –ª–∞–≤–∏–Ω–∏ –Ω–∞ –ï–≤–µ—Ä–µ—Å—Ç—ñ, ‚âà3.5 –º–ª–Ω –ª—é–¥–µ–π –±–µ–∑ –¥–æ–º—É.</p>
      </div>
    `;
    nepal.bindPopup(nepalPopup, { maxWidth: 320, className: 'custom-popup' });

    // Turkey-Syria earthquake (Feb 2023)
    const turkSyrCoords = [37.0, 38.0];
    const turkSyr = L.marker(turkSyrCoords).addTo(map);
    const turkSyrPopup = `
      <div class="custom-popup">
        <h3>–ó–µ–º–ª–µ—Ç—Ä—É—Å —É –¢—É—Ä–µ—á—á–∏–Ω—ñ —Ç–∞ –°–∏—Ä—ñ—ó (2023)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ü—ñ–≤–¥–µ–Ω–Ω–∞ –¢—É—Ä–µ—á—á–∏–Ω–∞, –ü—ñ–≤–Ω—ñ—á–Ω–∞ –°–∏—Ä—ñ—è</p>
        <p>–î–∞—Ç–∞: –õ—é—Ç–∏–π 2023 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ü–æ–¥–≤—ñ–π–Ω–∏–π –∑–µ–º–ª–µ—Ç—Ä—É—Å –º–∞–≥–Ω—ñ—Ç—É–¥–æ—é ~7.8 —ñ 7.5 ‚Äî –≤–µ–ª–∏–∫–∏–π —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∫–∞—Ç–∞–∫–ª—ñ–∑–º.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 55 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó—Ä—É–π–Ω–æ–≤–∞–Ω—ñ —Ü—ñ–ª—ñ –º—ñ—Å—Ç–∞, —Å–æ—Ç–Ω—ñ —Ç–∏—Å—è—á –±–µ–∑–¥–æ–º–Ω–∏—Ö, –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –∑–±–∏—Ç–∫–∏ ‚âà $100 –º–ª—Ä–¥.</p>
      </div>
    `;
    turkSyr.bindPopup(turkSyrPopup, { maxWidth: 360, className: 'custom-popup' });

    // Greece fires (2021, 2023)
    const greeceCoords = [38.0, 23.7];
    const greeceFires = L.marker(greeceCoords).addTo(map);
    const greecePopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –ì—Ä–µ—Ü—ñ—ó (2021, 2023)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ê—Ç—Ç–∏–∫–∞, –†–æ–¥–æ—Å, –ï–≤–±–µ—è</p>
        <p>–î–∞—Ç–∞: –õ—ñ—Ç–æ 2021, 2023 —Ä–æ–∫–∏</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–°–∏–ª—å–Ω–∞ —Å–ø–µ–∫–∞ —Ç–∞ –≤—ñ—Ç–µ—Ä —Å–ø—Ä–∏—á–∏–Ω–∏–ª–∏ –º–∞—Å—à—Ç–∞–±–Ω—ñ –ª—ñ—Å–æ–≤—ñ –ø–æ–∂–µ–∂—ñ.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –¥–µ—Å—è—Ç–∫–∏ –∑–∞–≥–∏–±–ª–∏—Ö.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ï–≤–∞–∫—É–∞—Ü—ñ—è —Ç–∏—Å—è—á —Ç—É—Ä–∏—Å—Ç—ñ–≤, –∑–Ω–∏—â–µ–Ω—ñ –ª—ñ—Å–∏, –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –∫—É—Ä–æ—Ä—Ç—ñ–≤, –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –µ—Ä–æ–∑—ñ—ó “ë—Ä—É–Ω—Ç—ñ–≤.</p>
      </div>
    `;
    greeceFires.bindPopup(greecePopup, { maxWidth: 340, className: 'custom-popup' });

    // Hurricane Ian (2022)
    const ianCoords = [27.0, -82.5];
    const ian = L.marker(ianCoords).addTo(map);
    const ianPopup = `
      <div class="custom-popup">
        <h3>–£—Ä–∞–≥–∞–Ω ¬´–Ü–∞–Ω¬ª (2022)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –§–ª–æ—Ä–∏–¥–∞, –ü—ñ–≤–¥–µ–Ω–Ω–∞ –ö–∞—Ä–æ–ª—ñ–Ω–∞</p>
        <p>–î–∞—Ç–∞: –í–µ—Ä–µ—Å–µ–Ω—å 2022 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–û–¥–∏–Ω —ñ–∑ –Ω–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–∏—Ö —É—Ä–∞–≥–∞–Ω—ñ–≤; —Å–∏–ª—å–Ω—ñ –≤—ñ—Ç—Ä–∏ —Ç–∞ —Ä—É–π–Ω—ñ–≤–Ω—ñ —à—Ç–æ—Ä–º–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 150 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü–æ—Ç—É–∂–Ω—ñ –ø–æ–≤–µ–Ω—ñ, –∑–±–∏—Ç–∫–∏ ‚âà $113 –º–ª—Ä–¥, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è 30 000 –±—É–¥–∏–Ω–∫—ñ–≤.</p>
      </div>
    `;
    ian.bindPopup(ianPopup, { maxWidth: 320, className: 'custom-popup' });

    // Storm Daniel / Europe floods (2023)
    const danielCoords = [34.5, 22.6];
    const daniel = L.marker(danielCoords).addTo(map);
    const danielPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤—ñ–Ω—å —É –Ñ–≤—Ä–æ–ø—ñ (–®—Ç–æ—Ä–º ¬´–î–µ–Ω—ñ–µ–ª¬ª, 2023)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ì—Ä–µ—Ü—ñ—è, –õ—ñ–≤—ñ—è, –ë–æ–ª–≥–∞—Ä—ñ—è</p>
        <p>–î–∞—Ç–∞: –í–µ—Ä–µ—Å–µ–Ω—å 2023 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ü–æ—Ç—É–∂–Ω–∏–π —Ü–∏–∫–ª–æ–Ω —ñ–∑ —Ç—Ä–∏–≤–∞–ª–∏–º–∏ –¥–æ—â–∞–º–∏ —Å–ø—Ä–∏—á–∏–Ω–∏–≤ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ñ—á–Ω—ñ –ø–æ–≤–µ–Ω—ñ.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 11 000 –æ—Å—ñ–± —É –õ—ñ–≤—ñ—ó (–∑–æ–∫—Ä–µ–º–∞ –º—ñ—Å—Ç–æ –î–µ—Ä–Ω–∞).</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–†—É–π–Ω—É–≤–∞–Ω–Ω—è –¥–∞–º–±, –∑–∞—Ç–æ–ø–ª–µ–Ω–Ω—è –º—ñ—Å—Ç, –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∞ –∫—Ä–∏–∑–∞, –¥–µ—Å—è—Ç–∫–∏ —Ç–∏—Å—è—á –∑–Ω–∏–∫–ª–∏—Ö.</p>
      </div>
    `;
    daniel.bindPopup(danielPopup, { maxWidth: 360, className: 'custom-popup' });

    // India droughts (multiple years)
    const indiaDroughtCoords = [22.0, 79.0];
    const indiaDrought = L.marker(indiaDroughtCoords).addTo(map);
    const indiaDroughtPopup = `
      <div class="custom-popup">
        <h3>–ü–æ—Å—É—Ö–∞ –≤ –Ü–Ω–¥—ñ—ó (2016, 2019, 2022)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ç–∞ –ü—ñ–≤–¥–µ–Ω–Ω–∞ –Ü–Ω–¥—ñ—è</p>
        <p>–î–∞—Ç–∞: 2016, 2019, 2022 —Ä–æ–∫–∏</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º—É—Å–æ–Ω–Ω–∏—Ö –¥–æ—â—ñ–≤, –≤–∏—Å–∏—Ö–∞–Ω–Ω—è —Ä—ñ—á–æ–∫, —Å–µ—Ä–π–æ–∑–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –≤—Ä–æ–∂–∞—î–º.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 1 500 —Ñ–µ—Ä–º–µ—Ä—ñ–≤ (—Å–∞–º–æ–≥—É–±—Å—Ç–≤–∞ —Ç–∞ —ñ–Ω—à—ñ –≤—Ç—Ä–∞—Ç–∏).</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó–Ω–∏–∂–µ–Ω–Ω—è –≤—Ä–æ–∂–∞—ó–≤, –ø—Ä–æ–¥–æ–≤–æ–ª—å—á—ñ –ø—Ä–æ–±–ª–µ–º–∏, –≤–Ω—É—Ç—Ä—ñ—à–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ—è.</p>
      </div>
    `;
    indiaDrought.bindPopup(indiaDroughtPopup, { maxWidth: 340, className: 'custom-popup' });

    // Greenland glacier melt (selected years)
    const greenlandCoords = [72.0, -40.0];
    const greenland = L.marker(greenlandCoords).addTo(map);
    const greenlandPopup = `
      <div class="custom-popup">
        <h3>–¢–∞–Ω–µ–Ω–Ω—è –ª—å–æ–¥–æ–≤–∏–∫—ñ–≤ –ì—Ä–µ–Ω–ª–∞–Ω–¥—ñ—ó</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ì—Ä–µ–Ω–ª–∞–Ω–¥—ñ—è</p>
        <p>–î–∞—Ç–∞: 2012, 2019, 2023 (—ñ —ñ–Ω—à—ñ —Ä–æ–∫–∏)</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ú–∞—Å–æ–≤–µ —Ç–∞–Ω–µ–Ω–Ω—è –ª—å–æ–¥—É –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö –¥—ñ–ª—è–Ω–∫–∞—Ö –ø–æ–≤–µ—Ä—Ö–Ω—ñ, –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ —Ä–µ–∫–æ—Ä–¥–∏ –≤—Ç—Ä–∞—Ç –ª—å–æ–¥—É.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –Ω–µ–º–∞—î –ø—Ä—è–º–∏—Ö.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –º–æ—Ä—è, –∑–º—ñ–Ω–∏ —Ç–µ—á—ñ–π, –≤–ø–ª–∏–≤ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—É –ø–æ–≥–æ–¥—É.</p>
      </div>
    `;
    greenland.bindPopup(greenlandPopup, { maxWidth: 320, className: 'custom-popup' });

    // Turkey fires (2021)
    const turkeyCoords = [36.9, 30.7];
    const turkeyFires = L.marker(turkeyCoords).addTo(map);
    const turkeyPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –¢—É—Ä–µ—á—á–∏–Ω—ñ (2021)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ü—ñ–≤–¥–µ–Ω–Ω–µ —É–∑–±–µ—Ä–µ–∂–∂—è –¢—É—Ä–µ—á—á–∏–Ω–∏ (–ê–Ω—Ç–∞–ª—ñ—è, –ú—É–≥–ª–∞)</p>
        <p>–î–∞—Ç–∞: –õ–∏–ø–µ–Ω—å‚Äì—Å–µ—Ä–ø–µ–Ω—å 2021 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ú–∞—Å—à—Ç–∞–±–Ω—ñ –ª—ñ—Å–æ–≤—ñ –ø–æ–∂–µ–∂—ñ –ø—ñ–¥ —á–∞—Å —Å–∏–ª—å–Ω–æ—ó —Å–ø–µ–∫–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> —â–æ–Ω–∞–π–º–µ–Ω—à–µ 8 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ó–Ω–∏—â–µ–Ω—ñ –ª—ñ—Å–∏, –µ–≤–∞–∫—É–∞—Ü—ñ—ó, –∑–Ω–∞—á–Ω—ñ –∑–±–∏—Ç–∫–∏ —Ç—É—Ä–∏—Å—Ç–∏—á–Ω—ñ–π –≥–∞–ª—É–∑—ñ.</p>
      </div>
    `;
    turkeyFires.bindPopup(turkeyPopup, { maxWidth: 320, className: 'custom-popup' });

    // Iberian fires (Spain & Portugal, 2022-2023)
    const iberiaCoords = [40.0, -4.0];
    const iberiaFires = L.marker(iberiaCoords).addTo(map);
    const iberiaPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –Ü—Å–ø–∞–Ω—ñ—ó —Ç–∞ –ü–æ—Ä—Ç—É–≥–∞–ª—ñ—ó (2022‚Äì2023)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –Ü–±–µ—Ä—ñ–π—Å—å–∫–∏–π –ø—ñ–≤–æ—Å—Ç—Ä—ñ–≤</p>
        <p>–î–∞—Ç–∞: –õ—ñ—Ç–æ 2022‚Äì2023 —Ä–æ–∫—ñ–≤</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–†–µ–∫–æ—Ä–¥–Ω—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —Ç–∞ —Å–æ—Ç–Ω—ñ –ª—ñ—Å–æ–≤–∏—Ö –ø–æ–∂–µ–∂.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 100 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü–æ–Ω–∞–¥ 250 000 –≥–∞ –∑–∞–≥–∏–±–ª–∏—Ö –ª—ñ—Å—ñ–≤, –∑–Ω–∞—á–Ω—ñ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫—ñ –≤—Ç—Ä–∞—Ç–∏, ‚âà‚Ç¨3 –º–ª—Ä–¥ –∑–±–∏—Ç–∫—ñ–≤.</p>
      </div>
    `;
    iberiaFires.bindPopup(iberiaPopup, { maxWidth: 340, className: 'custom-popup' });

    // Indian Ocean tsunami 2004 (use a central marker over Sumatra)
    const tsunami2004Coords = [3.0, 95.0]; // off the west coast of Sumatra
    const tsunami2004 = L.marker(tsunami2004Coords).addTo(map);
    const tsunami2004Popup = `
      <div class="custom-popup">
        <h3>–¶—É–Ω–∞–º—ñ –≤ –Ü–Ω–¥—ñ–π—Å—å–∫–æ–º—É –æ–∫–µ–∞–Ω—ñ (2004)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –Ü–Ω–¥–æ–Ω–µ–∑—ñ—è, –®—Ä—ñ-–õ–∞–Ω–∫–∞, –¢–∞—ó–ª–∞–Ω–¥, –Ü–Ω–¥—ñ—è</p>
        <p>–î–∞—Ç–∞: 26 –≥—Ä—É–¥–Ω—è 2004 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ó–µ–º–ª–µ—Ç—Ä—É—Å –º–∞–≥–Ω—ñ—Ç—É–¥–æ—é 9,1 –±—ñ–ª—è –°—É–º–∞—Ç—Ä–∏ —Å–ø—Ä–∏—á–∏–Ω–∏–≤ —Ö–≤–∏–ª—é —Ü—É–Ω–∞–º—ñ –¥–æ 30 –º–µ—Ç—Ä—ñ–≤ –∑–∞–≤–≤–∏—à–∫–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 230 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ü–æ–≤–Ω–µ –∑–Ω–∏—â–µ–Ω–Ω—è –ø—Ä–∏–±–µ—Ä–µ–∂–Ω–∏—Ö –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤, —Å–æ—Ç–Ω—ñ —Ç–∏—Å—è—á –∑–Ω–∏–∫–ª–∏—Ö, –º—ñ–ª—å–π–æ–Ω–∏ –±–µ–∑–¥–æ–º–Ω–∏—Ö, –≤–µ–ª–∏–∫—ñ –≤—Ç—Ä–∞—Ç–∏ —É —Ç—É—Ä–∏–∑–º—ñ —Ç–∞ —Ä–∏–±–∞–ª—å—Å—Ç–≤—ñ, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ —Ä–∞–Ω–Ω—å–æ–≥–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ —Ü—É–Ω–∞–º—ñ –≤ –Ü–Ω–¥—ñ–π—Å—å–∫–æ–º—É –æ–∫–µ–∞–Ω—ñ.</p>
      </div>
    `;
    tsunami2004.bindPopup(tsunami2004Popup, { maxWidth: 320, className: 'custom-popup' });

    // Hurricane Katrina 2005 (New Orleans area)
    const katrinaCoords = [29.95, -90.07]; // near New Orleans
    const katrina = L.marker(katrinaCoords).addTo(map);
    const katrinaPopup = `
      <div class="custom-popup">
        <h3>–£—Ä–∞–≥–∞–Ω ¬´–ö–∞—Ç—Ä—ñ–Ω–∞¬ª (2005)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –°–®–ê (–õ—É—ó–∑—ñ–∞–Ω–∞, –ú—ñ—Å—Å—ñ—Å—ñ–ø—ñ, –ù–æ–≤–∏–π –û—Ä–ª–µ–∞–Ω)</p>
        <p>–î–∞—Ç–∞: –°–µ—Ä–ø–µ–Ω—å 2005 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–û–¥–∏–Ω —ñ–∑ –Ω–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–∏—Ö —É—Ä–∞–≥–∞–Ω—ñ–≤ –ê—Ç–ª–∞–Ω—Ç–∏–∫–∏. –ó—Ä—É–π–Ω—É–≤–∞–≤ –¥–∞–º–±–∏ –ù–æ–≤–æ–≥–æ –û—Ä–ª–µ–∞–Ω–∞, –∑–∞—Ç–æ–ø–∏–≤—à–∏ –º—ñ—Å—Ç–æ.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –±–ª–∏–∑—å–∫–æ 1 800 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ï–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –≤—Ç—Ä–∞—Ç–∏ –ø–æ–Ω–∞–¥ $160 –º–ª—Ä–¥, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏, –±—ñ–∂–µ–Ω—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –°–®–ê, –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —É–≤–∞–≥–∏ –¥–æ –ø—Ä–æ–±–ª–µ–º–∏ –∫–ª—ñ–º–∞—Ç–∏—á–Ω–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤.</p>
      </div>
    `;
    katrina.bindPopup(katrinaPopup, { maxWidth: 320, className: 'custom-popup' });

    // Amazon fires (central Amazon)
    const amazonCoords = [-3.4653, -62.2159];
    const amazon = L.marker(amazonCoords).addTo(map);
    const amazonPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–∂–µ–∂—ñ –≤ –ê–º–∞–∑–æ–Ω—ñ—ó</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ê–º–∞–∑–æ–Ω—Å—å–∫—ñ –¥–∂—É–Ω–≥–ª—ñ (–ë—Ä–∞–∑–∏–ª—ñ—è, –ü–µ—Ä—É, –ë–æ–ª—ñ–≤—ñ—è)</p>
        <p>–î–∞—Ç–∞: 2005, 2010, 2019, 2020 —Ä–æ–∫–∏</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ú–∞—Å–æ–≤—ñ –ø—ñ–¥–ø–∞–ª–∏ —Ç–∞ –ø–æ—Å—É—Ö–∏ —Å–ø—Ä–∏—á–∏–Ω–∏–ª–∏ —Å–æ—Ç–Ω—ñ —Ç–∏—Å—è—á –ø–æ–∂–µ–∂.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –¥–µ—Å—è—Ç–∫–∏ –ª—é–¥–µ–π, –º—ñ–ª—å–π–æ–Ω–∏ –∑–∞–≥–∏–±–ª–∏—Ö —Ç–≤–∞—Ä–∏–Ω.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–†—É–π–Ω—É–≤–∞–Ω–Ω—è 10 –º–ª–Ω –≥–∞ –ª—ñ—Å—ñ–≤, –≤–∏–∫–∏–¥ CO‚ÇÇ, –∑–Ω–∏–∂–µ–Ω–Ω—è –∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ –ê–º–∞–∑–æ–Ω—ñ—ó –ø–æ–≥–ª–∏–Ω–∞—Ç–∏ –≤—É–≥–ª–µ—Ü—å, –≤–ø–ª–∏–≤ –Ω–∞ –∫–ª—ñ–º–∞—Ç —É –≤—Å—ñ–π –ü—ñ–≤–¥–µ–Ω–Ω—ñ–π –ê–º–µ—Ä–∏—Ü—ñ.</p>
      </div>
    `;
    amazon.bindPopup(amazonPopup, { maxWidth: 320, className: 'custom-popup' });

    // Pakistan floods 2010 (central Pakistan)
    const pakistanCoords = [28.0, 69.0];
    const pakistan = L.marker(pakistanCoords).addTo(map);
    const pakistanPopup = `
      <div class="custom-popup">
        <h3>–ü–æ–≤—ñ–Ω—å —É –ü–∞–∫–∏—Å—Ç–∞–Ω—ñ (2010)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —ñ –ø—ñ–≤–¥–µ–Ω–Ω–∏–π –ü–∞–∫–∏—Å—Ç–∞–Ω</p>
        <p>–î–∞—Ç–∞: –õ–∏–ø–µ–Ω—å‚Äì–≤–µ—Ä–µ—Å–µ–Ω—å 2010 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–¥–∑–≤–∏—á–∞–π–Ω–æ —Å–∏–ª—å–Ω—ñ –º—É—Å–æ–Ω–Ω—ñ –¥–æ—â—ñ –∑–∞—Ç–æ–ø–∏–ª–∏ 20 % —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó –∫—Ä–∞—ó–Ω–∏.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 1 700 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>20 –º–ª–Ω –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö, –∑–Ω–∏—â–µ–Ω–æ –ø–æ—Å—ñ–≤–∏, –ø–æ—à–∏—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ–µ–∫—Ü—ñ–π, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –º–æ—Å—Ç—ñ–≤ —ñ –¥–æ—Ä—ñ–≥, —Å–µ—Ä–π–æ–∑–Ω—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ–∫–∏.</p>
      </div>
    `;
    pakistan.bindPopup(pakistanPopup, { maxWidth: 320, className: 'custom-popup' });

    // East Africa drought 2011 (Horn of Africa)
    const eafricaCoords = [4.5, 44.0];
    const eafrica = L.marker(eafricaCoords).addTo(map);
    const eafricaPopup = `
      <div class="custom-popup">
        <h3>–ü–æ—Å—É—Ö–∞ –≤ –°—Ö—ñ–¥–Ω—ñ–π –ê—Ñ—Ä–∏—Ü—ñ (2011)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –°–æ–º–∞–ª—ñ, –ï—Ñ—ñ–æ–ø—ñ—è, –ö–µ–Ω—ñ—è</p>
        <p>–î–∞—Ç–∞: 2011 —Ä—ñ–∫</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π–≥—ñ—Ä—à–∞ –ø–æ—Å—É—Ö–∞ –∑–∞ 60 —Ä–æ–∫—ñ–≤ —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–æ—â—ñ–≤ –¥–≤–∞ —Å–µ–∑–æ–Ω–∏ –ø–æ—Å–ø—ñ–ª—å.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> –ø–æ–Ω–∞–¥ 250 000 –æ—Å—ñ–±.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–ì–æ–ª–æ–¥, –Ω–µ—Å—Ç–∞—á–∞ –ø–∏—Ç–Ω–æ—ó –≤–æ–¥–∏, –∑–∞–≥–∏–±–µ–ª—å —Ö—É–¥–æ–±–∏, –º–∞—Å–æ–≤—ñ –ø–µ—Ä–µ—Å–µ–ª–µ–Ω–Ω—è, –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∞ –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∞ –∫—Ä–∏–∑–∞.</p>
      </div>
    `;
    eafrica.bindPopup(eafricaPopup, { maxWidth: 320, className: 'custom-popup' });

    // Hurricane Sandy 2012 (NY/NJ)
    const sandyCoords = [40.7128, -74.0060];
    const sandy = L.marker(sandyCoords).addTo(map);
    const sandyPopup = `
      <div class="custom-popup">
        <h3>–£—Ä–∞–≥–∞–Ω ¬´–°–µ–Ω–¥—ñ¬ª (2012)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –°–®–ê (–ù—å—é-–ô–æ—Ä–∫, –ù—å—é-–î–∂–µ—Ä—Å—ñ)</p>
        <p>–î–∞—Ç–∞: –ñ–æ–≤—Ç–µ–Ω—å 2012 —Ä–æ–∫—É</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–û–¥–∏–Ω —ñ–∑ –Ω–∞–π–¥–æ—Ä–æ–∂—á–∏—Ö —É—Ä–∞–≥–∞–Ω—ñ–≤ XXI —Å—Ç–æ–ª—ñ—Ç—Ç—è, —Å–∏–ª—å–Ω–∏–π –≤—ñ—Ç–µ—Ä —ñ –∑–∞—Ç–æ–ø–ª–µ–Ω–Ω—è —É–∑–±–µ—Ä–µ–∂–∂—è.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> 233 –æ—Å–æ–±–∏.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–†—É–π–Ω—É–≤–∞–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂, –ø—ñ–¥—Ç–æ–ø–ª–µ–Ω–Ω—è –º–µ—Ç—Ä–æ, –∑–±–∏—Ç–∫–∏ –ø–æ–Ω–∞–¥ $70 –º–ª—Ä–¥, –∑–º—ñ–Ω–∏ —É –º—ñ—Å—å–∫–æ–º—É –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—ñ –ù—å—é-–ô–æ—Ä–∫–∞ –¥–ª—è –±–æ—Ä–æ—Ç—å–±–∏ –∑ –º–∞–π–±—É—Ç–Ω—ñ–º–∏ —à—Ç–æ—Ä–º–∞–º–∏.</p>
      </div>
    `;
    sandy.bindPopup(sandyPopup, { maxWidth: 320, className: 'custom-popup' });

    // Australian Black Summer fires 2019-2020 (southeast Australia)
    const ausCoords = [-33.8688, 151.2093]; // Sydney area as anchor
    const ausFires = L.marker(ausCoords).addTo(map);
    const ausPopup = `
      <div class="custom-popup">
        <h3>–ê–≤—Å—Ç—Ä–∞–ª—ñ–π—Å—å–∫—ñ –ø–æ–∂–µ–∂—ñ ¬´Black Summer¬ª (2019-2020)</h3>
        <p>–ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å: –ê–≤—Å—Ç—Ä–∞–ª—ñ—è</p>
        <p>–î–∞—Ç–∞: –ª–∏–ø–µ–Ω—å 2019 ‚Äì –±–µ—Ä–µ–∑–µ–Ω—å 2020</p>
        <h4>–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h4>
        <p>–ù–∞–π–º–∞—Å—à—Ç–∞–±–Ω—ñ—à—ñ –ø–æ–∂–µ–∂—ñ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –∫—Ä–∞—ó–Ω–∏, –∑–Ω–∏—â–µ–Ω–æ –≤–µ–ª–∏—á–µ–∑–Ω—ñ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó –ª—ñ—Å—ñ–≤.</p>
        <p><strong>–ñ–µ—Ä—Ç–≤–∏:</strong> 34 –ª—é–¥–∏–Ω–∏, –ø–æ–Ω–∞–¥ 3 –º–ª—Ä–¥ —Ç–≤–∞—Ä–∏–Ω –∑–∞–≥–∏–Ω—É–ª–∏ –∞–±–æ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏.</p>
        <h4>–ù–∞—Å–ª—ñ–¥–∫–∏</h4>
        <p>–í–∏–≥–æ—Ä—ñ–ª–æ –ø–æ–Ω–∞–¥ 18 –º–ª–Ω –≥–µ–∫—Ç–∞—Ä—ñ–≤, –¥–µ—Å—è—Ç–∫–∏ –º—ñ—Å—Ç –µ–≤–∞–∫—É–π–æ–≤–∞–Ω–æ, —Å–∏–ª—å–Ω–µ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø–æ–≤—ñ—Ç—Ä—è, –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –≤—Ç—Ä–∞—Ç–∏ –ø–æ–Ω–∞–¥ $100 –º–ª—Ä–¥.</p>
      </div>
    `;
    ausFires.bindPopup(ausPopup, { maxWidth: 320, className: 'custom-popup' });

    // --- Timeline / day slider logic ---
    // Helper date functions
    function toDateYMD(d) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd}`;
    }
    function parseYMD(s) { // 'YYYY-MM-DD' -> Date at UTC midnight
      const [y,m,d] = s.split('-').map(Number);
      return new Date(Date.UTC(y,m-1,d));
    }

    const SLIDER_START = parseYMD('2000-01-01');
    const SLIDER_END = parseYMD('2025-12-31');
    const MS_PER_DAY = 24*3600*1000;
    const totalDays = Math.round((SLIDER_END - SLIDER_START)/MS_PER_DAY);

    // Helper: create emoji divIcon by type
    function makeIcon(type) {
      const map = {
        fire: 'üî•', flood: 'üåä', hurricane: 'üåÄ', earthquake: 'üåã', drought: '‚òÄÔ∏è', heat: 'üî•', glacier: 'üßä', tsunami: 'üåä', storm: '‚õàÔ∏è', other: '‚ö†Ô∏è'
      };
      const emoji = map[type] || map.other;
      return L.divIcon({ className: 'custom-div-icon', html: `<div class="marker-icon">${emoji}</div>`, iconSize: [34,34], iconAnchor: [17,34] });
    }

    // Build an events array mapping markers to start/end date strings (inclusive) and types
    const events = [
      { id: 'odessa', marker: odessaMarker, start: '2025-09-30', end: '2025-09-30', type: 'flood' },
      { id: 'heat2003', marker: heat2003, start: '2003-07-01', end: '2003-08-31', type: 'heat' },
  { id: 'ger2021', marker: ger2021, start: '2021-07-01', end: '2021-07-31', type: 'flood' },
  { id: 'lytton', marker: lytton, start: '2021-06-01', end: '2021-06-30', type: 'heat' },
  { id: 'pakistan22', marker: pakistan22, start: '2022-08-01', end: '2022-09-30', type: 'flood' },
  { id: 'globalHeat', marker: globalHeat, start: '2023-01-01', end: '2023-12-31', type: 'heat' },
  { id: 'arctic', marker: arcticAnom, start: '2024-01-01', end: '2024-12-31', type: 'glacier' },
  { id: 'rio', marker: rioFloods, start: '2022-02-01', end: '2022-02-28', type: 'flood' },
  { id: 'irma', marker: irma, start: '2017-09-01', end: '2017-09-30', type: 'hurricane' },
  { id: 'maria', marker: maria, start: '2017-09-01', end: '2017-09-30', type: 'hurricane' },
  { id: 'campFire', marker: campFire, start: '2018-11-01', end: '2018-11-30', type: 'fire' },
  { id: 'siberia', marker: siberia, start: '2019-06-01', end: '2021-09-30', type: 'fire' },
  { id: 'yangtze', marker: yangtze, start: '2020-07-01', end: '2020-08-31', type: 'flood' },
  { id: 'haiti', marker: haiti, start: '2010-01-12', end: '2010-01-12', type: 'earthquake' },
  { id: 'nepal', marker: nepal, start: '2015-04-25', end: '2015-04-25', type: 'earthquake' },
  { id: 'turkSyr', marker: turkSyr, start: '2023-02-06', end: '2023-02-06', type: 'earthquake' },
  { id: 'greece', marker: greeceFires, start: '2021-07-01', end: '2023-08-31', type: 'fire' },
  { id: 'ian', marker: ian, start: '2022-09-01', end: '2022-09-30', type: 'hurricane' },
  { id: 'daniel', marker: daniel, start: '2023-09-01', end: '2023-09-30', type: 'storm' },
  { id: 'indiaDrought', marker: indiaDrought, start: '2016-01-01', end: '2022-12-31', type: 'drought' },
  { id: 'greenland', marker: greenland, start: '2012-01-01', end: '2023-12-31', type: 'glacier' },
  { id: 'turkeyFires', marker: turkeyFires, start: '2021-07-01', end: '2021-08-31', type: 'fire' },
  { id: 'iberia', marker: iberiaFires, start: '2022-06-01', end: '2023-08-31', type: 'fire' },
  { id: 'tsunami2004', marker: tsunami2004, start: '2004-12-26', end: '2004-12-26', type: 'tsunami' },
  { id: 'katrina', marker: katrina, start: '2005-08-01', end: '2005-08-31', type: 'hurricane' },
  { id: 'amazon', marker: amazon, start: '2005-01-01', end: '2020-12-31', type: 'fire' },
  { id: 'pakistan2010', marker: pakistan, start: '2010-07-01', end: '2010-09-30', type: 'flood' },
  { id: 'eafrica', marker: eafrica, start: '2011-01-01', end: '2011-12-31', type: 'drought' },
  { id: 'sandy', marker: sandy, start: '2012-10-01', end: '2012-10-31', type: 'storm' },
      { id: 'aus', marker: ausFires, start: '2019-07-01', end: '2020-03-31', type: 'fire' }
    ];

    // apply icons to markers according to type
    events.forEach(ev => {
      if (ev.type && ev.marker && ev.marker.setIcon) {
        ev.marker.setIcon(makeIcon(ev.type));
      }
    });

    // Helper: show/hide markers by selected date (YYYY-MM-DD)
    function updateMarkersForDate(dateStr) {
      const sel = parseYMD(dateStr);
      events.forEach(ev => {
        const start = parseYMD(ev.start);
        const end = parseYMD(ev.end);
        const visible = sel >= start && sel <= end;
        if (visible) {
          if (!map.hasLayer(ev.marker)) ev.marker.addTo(map);
        } else {
          if (map.hasLayer(ev.marker)) map.removeLayer(ev.marker);
        }
      });
    }

    // Helper: update MODIS layer to a given date string and sync dateLabel
    function updateModisForDate(dateStr) {
      document.getElementById('dateInput').value = dateStr;
      document.getElementById('dateLabel').textContent = dateStr;
      updateModis(dateStr);
    }

    // Helper: update MODIS layer to an arbitrary date string YYYY-MM-DD
    function updateModis(dateStr) {
      modisDate = dateStr;
      if (modisLayer) map.removeLayer(modisLayer);
      modisLayer = L.tileLayer(makeGIBSUrl(MODIS_LAYER_ID, modisDate), { tileSize:256, opacity:0.95, attribution:'NASA GIBS' });
      modisLayer.addTo(map);
    }

    // Keep date input and slider synchronized when date input is changed manually
    const dateInputEl = document.getElementById('dateInput');
    dateInputEl.addEventListener('change', (e) => {
      const d = e.target.value; // YYYY-MM-DD
      if (!d) return;
      // Set slider position to this date
      const idx = dateStrToSlider(d);
      dateSlider.value = Math.max(0, Math.min(totalDays, idx));
      // Update MODIS and markers for the chosen date
      updateModisForDate(d);
      updateMarkersForDate(d);
    });

    // Wire the date slider
    const dateSlider = document.getElementById('dateSlider');
    const dateLabel = document.getElementById('dateLabel');
    // configure slider range
    dateSlider.min = 0;
    dateSlider.max = totalDays;
    // convert slider value (days since SLIDER_START) to YYYY-MM-DD
    function sliderToDateStr(v) {
      const d = new Date(SLIDER_START.getTime() + v*MS_PER_DAY);
      return toDateYMD(d);
    }
    function dateStrToSlider(dateStr) {
      const d = parseYMD(dateStr);
      return Math.round((d - SLIDER_START)/MS_PER_DAY);
    }

    dateSlider.addEventListener('input', (e) => {
      const v = parseInt(e.target.value,10);
      const dateStr = sliderToDateStr(v);
      dateLabel.textContent = dateStr;
      // update date input and MODIS
      updateModisForDate(dateStr);
      // update markers
      updateMarkersForDate(dateStr);
    });

    // Initialize slider to current dateInput
    (function initSliderFromInput(){
      const cur = document.getElementById('dateInput').value || toDateYMD(new Date());
      const idx = dateStrToSlider(cur);
      dateSlider.value = Math.max(0, Math.min(totalDays, idx));
      const dateStr = sliderToDateStr(dateSlider.value);
      dateLabel.textContent = dateStr;
      updateModisForDate(dateStr);
      updateMarkersForDate(dateStr);
    })();

    // Show-all checkbox behavior
    const showAllCheckbox = document.getElementById('showAllCheckbox');
    let showAll = false;
    function showAllMarkers() {
      events.forEach(ev => { if (!map.hasLayer(ev.marker)) ev.marker.addTo(map); });
    }
    function hideAllMarkers() {
      events.forEach(ev => { if (map.hasLayer(ev.marker)) map.removeLayer(ev.marker); });
    }
    showAllCheckbox.addEventListener('change', (e) => {
      showAll = !!e.target.checked;
      if (showAll) {
        // disable slider and date input to avoid confusion
        dateSlider.disabled = true;
        dateInputEl.disabled = true;
        showAllMarkers();
      } else {
        dateSlider.disabled = false;
        dateInputEl.disabled = false;
        // restore state for current slider date
        const curDate = sliderToDateStr(parseInt(dateSlider.value,10));
        updateMarkersForDate(curDate);
      }
    });

    // UI controls
    document.getElementById('applyBtn').addEventListener('click', () => {
      const d = document.getElementById('dateInput').value;
      if (!d) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD');
      // Set slider and update MODIS + markers for the chosen date
      const idx = dateStrToSlider(d);
      dateSlider.value = Math.max(0, Math.min(totalDays, idx));
      updateModisForDate(d);
      updateMarkersForDate(d);
    });

    document.getElementById('toggleModis').addEventListener('click', (e) => {
      if (map.hasLayer(modisLayer)) { map.removeLayer(modisLayer); e.target.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å MODIS'; }
      else { modisLayer.addTo(map); e.target.textContent = '–°–∫—Ä—ã—Ç—å MODIS'; }
    });

    // --- GeoTIFF/COG overlay (MOPITT example) ---
    // NOTE: COG must be publicly accessible and support CORS. If Earthdata-protected, use server-side preprocessing.
    

    // guard removeCog button (it may not exist)
    const removeCogBtn = document.getElementById('removeCog');
    if (removeCogBtn) {
      removeCogBtn.addEventListener('click', () => {
        if (typeof cogLayer !== 'undefined' && cogLayer) { map.removeLayer(cogLayer); cogLayer = null; }
      });
    }

    // --- –ü–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –≤–∞—Å (–≤ –∫–æ–¥–µ/–≤ UI) ---
    // 1) –ï—Å–ª–∏ MOPITT/ASTER —Ñ–∞–π–ª—ã –∑–∞—â–∏—â–µ–Ω—ã Earthdata Login, –ª—É—á—à–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
    //    - —Å–∫–∞—á–∞—Ç—å –Ω—É–∂–Ω—É—é –¥–∞—Ç—É/–ø—Ä–æ–¥—É–∫—Ç (—á–µ—Ä–µ–∑ ASDC/GIOVANNI/Earthdata API),
    //    - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ COG (gdal_translate -of COG ...) –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ S3 –∏–ª–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ —Å CORS,
    //    - –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ.
    // 2) –°—Å—ã–ª–∫–∞ –Ω–∞ GIBS docs: https://nasa-gibs.github.io/gibs-api-docs/access-basics/ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è MODIS WMTS/WMS). 
    // 3) –ò—Å—Ç–æ—á–Ω–∏–∫–∏ MOPITT: ASDC / Giovanni / MOPITT pages (–≥–¥–µ —Å–∫–∞—á–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏).
  </script>

  <script>
    // Bind simple hover tooltips from each marker's popup <h3> (if present)
    function bindTooltipsToMarkers() {
      events.forEach(ev => {
        try {
          // Remove existing tooltip to avoid duplicates
          if (ev.marker && ev.marker.unbindTooltip) ev.marker.unbindTooltip();
          let title = '';
          if (ev.marker && ev.marker.getPopup && ev.marker.getPopup()) {
            const content = ev.marker.getPopup().getContent();
            if (content) {
              const tmp = document.createElement('div');
              tmp.innerHTML = content;
              const h = tmp.querySelector('h3');
              if (h) title = h.textContent.trim();
              else title = tmp.textContent.trim().split('\n')[0].slice(0,120);
            }
          }
          if (!title) title = ev.id || '–ü–æ–¥—ñ—è';
          if (ev.marker && ev.marker.bindTooltip) {
            ev.marker.bindTooltip(title, { direction: 'top', offset: [0, -12], opacity: 0.9 });
          }
        } catch (err) {
          // ignore tooltip binding errors for any marker
          console.warn('Tooltip bind failed for', ev && ev.id, err);
        }
      });
    }

    // Update the visible count display based on which markers are currently on the map
    function updateVisibleCount() {
      const countEl = document.getElementById('visibleCount');
      if (!countEl) return;
      let cnt = 0;
      events.forEach(ev => { if (ev.marker && map.hasLayer(ev.marker)) cnt++; });
      countEl.textContent = String(cnt);
      return cnt;
    }

    // Wire the Zoom-to-all button to fit bounds to visible markers
    const zoomAllBtn = document.getElementById('zoomAllBtn');
    if (zoomAllBtn) {
      zoomAllBtn.addEventListener('click', () => {
        const visibleMarkers = events.filter(ev => ev.marker && map.hasLayer(ev.marker)).map(ev => ev.marker);
        console.debug('zoomAllBtn clicked, visibleMarkers count:', visibleMarkers.length);
        if (!visibleMarkers.length) {
          // If none are visible, inform user and try to zoom to map extent
          alert('–ù–µ–º–∞—î –≤–∏–¥–∏–º–∏—Ö —Ñ–ª–∞–≥—ñ–≤ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–º–∫–Ω—É—Ç–∏ "–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ñ–ª–∞–≥–∏" –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –¥–∞—Ç—É.');
          return;
        }
        try {
          if (visibleMarkers.length === 1) {
            // single marker: set view to marker with an appropriate zoom
            const latlng = visibleMarkers[0].getLatLng ? visibleMarkers[0].getLatLng() : null;
            if (latlng) {
              map.setView(latlng, Math.min(map.getMaxZoom(), 8));
              return;
            }
          }
          const group = L.featureGroup(visibleMarkers);
          const bounds = group.getBounds();
          if (!bounds || !bounds.isValid || !bounds.isValid()) {
            // older Leaflet versions may not have isValid; fallback check
            if (!bounds || bounds.getSouthWest == null) {
              console.warn('Computed bounds are invalid, aborting fitBounds:', bounds);
              alert('–ù–µ–º–æ–∂–ª–∏–≤–æ –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è: –Ω–µ–≤—ñ—Ä–Ω—ñ –º–µ–∂—ñ.');
              return;
            }
          }
          map.fitBounds(bounds.pad ? bounds.pad(0.2) : bounds, { padding: [30,30] });
        } catch (err) {
          console.error('Zoom to all failed', err);
          alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—ñ. –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
        }
      });
    }

    // Ensure tooltips are bound and count is correct after initial setup
    bindTooltipsToMarkers();
    updateVisibleCount();

    // Also call updateVisibleCount whenever markers are shown/hidden by date or showAll
    // Patch updateMarkersForDate and showAll handlers by wrapping them with calls.
    // (We can't reliably rewrite earlier functions here, so we just observe map 'layeradd'/'layerremove')
    map.on('layeradd layerremove', () => {
      // small debounce-ish behaviour
      setTimeout(updateVisibleCount, 50);
    });
  </script>

    
</body>

</html>
